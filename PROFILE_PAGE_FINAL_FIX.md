# æœƒå“¡ä¸­å¿ƒé é¢æœ€çµ‚ä¿®å¾©ç¸½çµ

## âœ… å·²å®Œæˆçš„ä¿®å¾©

### 1. å¼·åˆ¶å»ºç«‹ä¸¦ä¿®æ­£é é¢æª”æ¡ˆ

#### æª”æ¡ˆç¢ºèª
- âœ… `app/profile/page.tsx` æª”æ¡ˆå­˜åœ¨ä¸”è·¯å¾‘æ­£ç¢º
- âœ… ä½æ–¼æ­£ç¢ºçš„è³‡æ–™å¤¾ `app/profile/`
- âœ… æœ‰æ­£ç¢ºçš„ `export default function ProfilePage()`
- âœ… ä¸åŒ…å«æœƒå°è‡´ 500 éŒ¯èª¤çš„é‚è¼¯

### 2. ä¿®å¾©å°è¦½åˆ—é€£çµ (Navbar)

#### Header çµ„ä»¶ä¿®å¾©
- âœ… ç¢ºä¿äººåƒåœ–ç¤ºçš„ `<Link>` æ¨™ç±¤æŒ‡å‘ `href="/profile"`
- âœ… åŠ å…¥å®¢æˆ¶ç«¯ç’°å¢ƒæª¢æŸ¥
- âœ… æ·»åŠ éŒ¯èª¤è™•ç†

#### é‚è¼¯ç¢ºèª
- âœ… è‹¥ä½¿ç”¨è€…æœªç™»å…¥ï¼Œé»æ“Šäººåƒå°å‘ `/auth/login`
- âœ… è‹¥å·²ç™»å…¥ï¼Œé»æ“Šäººåƒå°å‘ `/profile`

#### ä¿®æ”¹æª”æ¡ˆ
- `components/header.tsx`
  ```typescript
  // ç¢ºä¿åœ¨å®¢æˆ¶ç«¯ç’°å¢ƒä¸‹åŸ·è¡Œ
  useEffect(() => {
    if (typeof window === 'undefined') {
      return
    }
    checkUser()
  }, [])

  async function checkUser() {
    try {
      if (typeof window === 'undefined') {
        return
      }
      
      const supabase = createClient()
      const { data: { user }, error } = await supabase.auth.getUser()
      
      if (!error && user) {
        setUser(user)
      } else {
        setUser(null)
      }
    } catch (error) {
      console.error("Failed to check user:", error)
      setUser(null)
    }
  }
  ```

### 3. ä¿®å¾© Supabase å®¢æˆ¶ç«¯å ±éŒ¯

#### å•é¡Œä¿®å¾©
- âœ… ä½¿ç”¨ `createBrowserClient` ä¸¦ç¢ºä¿åœ¨å®¢æˆ¶ç«¯ç’°å¢ƒä¸­åŸ·è¡Œ
- âœ… é¿å…åœ¨ä¼ºæœå™¨ç«¯è®€å–ç€è¦½å™¨ Cookie å°è‡´çš„å´©æ½°
- âœ… æ·»åŠ å®Œæ•´çš„ç’°å¢ƒæª¢æŸ¥å’ŒéŒ¯èª¤è™•ç†

#### ä¿®æ”¹æª”æ¡ˆ
- `lib/supabase/client.ts` - å·²åŒ…å«å®Œæ•´çš„å®¢æˆ¶ç«¯ç’°å¢ƒæª¢æŸ¥
- `app/profile/page.tsx` - æ‰€æœ‰ Supabase èª¿ç”¨éƒ½æ·»åŠ äº†ç’°å¢ƒæª¢æŸ¥
- `components/header.tsx` - æ·»åŠ äº†ç’°å¢ƒæª¢æŸ¥

### 4. æœƒå“¡ä¸­å¿ƒä»‹é¢å¯¦ä½œ

#### Profile è³‡æ–™æŠ“å–
- âœ… å¾ `profiles` è¡¨æ ¼æŠ“å– `full_name` èˆ‡ `member_level`
- âœ… å¦‚æœä½¿ç”¨è€…åœ¨ `profiles` è¡¨ä¸­å°šç„¡è³‡æ–™ï¼Œè‡ªå‹•è§¸ç™¼ `insert` å‹•ä½œå»ºç«‹åˆå§‹è³‡æ–™
- âœ… é¡¯ç¤ºæœƒå“¡ç­‰ç´šæ¨™ç±¤ï¼ˆRegular/VIP/VVIPï¼‰

#### è¨‚å–®åˆ—è¡¨
- âœ… åˆ—å‡ºè©²ä½¿ç”¨è€…çš„æ‰€æœ‰è¨‚å–®ï¼ˆå¾ `orders` è¡¨æŠ“å–ï¼‰
- âœ… é¡¯ç¤ºè¨‚å–®ç·¨è™Ÿã€é‡‘é¡ã€ç‹€æ…‹
- âœ… é¡¯ç¤ºè¨‚å–®æ—¥æœŸã€æ”¯ä»˜æ–¹å¼
- âœ… é¡¯ç¤ºè¨‚å–®é …ç›®è©³æƒ…

#### ä¿®æ”¹æª”æ¡ˆ
- `app/profile/page.tsx`
  ```typescript
  async function loadProfile(userId: string) {
    // ç¢ºä¿åœ¨å®¢æˆ¶ç«¯ç’°å¢ƒä¸‹åŸ·è¡Œ
    if (typeof window === 'undefined') {
      return
    }
    
    const { data, error } = await supabase
      .from("profiles")
      .select("id, email, full_name, phone, address, member_level, membership_level, created_at")
      .eq("id", userId)
      .single()

    // å¦‚æœ profile ä¸å­˜åœ¨ï¼Œè‡ªå‹•å»ºç«‹ä¸€å€‹
    if (error.code === 'PGRST116' || error.message?.includes('No rows')) {
      const { data: newProfile } = await supabase
        .from("profiles")
        .insert([{
          id: userId,
          email: user?.email || null,
          full_name: user?.email?.split("@")[0] || null,
          member_level: "regular",
        }])
        .select()
        .single()
    }
  }
  ```

## ğŸ”§ æŠ€è¡“æ”¹é€²

### éŒ¯èª¤è™•ç†
- âœ… æ·»åŠ å®Œæ•´çš„ç’°å¢ƒæª¢æŸ¥ï¼ˆ`typeof window !== 'undefined'`ï¼‰
- âœ… æ·»åŠ éŒ¯èª¤æ•ç²å’Œè™•ç†
- âœ… å¦‚æœ profile ä¸å­˜åœ¨ï¼Œè‡ªå‹•å»ºç«‹é è¨­ profile
- âœ… å³ä½¿å»ºç«‹å¤±æ•—ï¼Œä¹Ÿè¨­ç½®åŸºæœ¬ profile ä»¥é¿å…é é¢å´©æ½°

### ç”¨æˆ¶é«”é©—
- âœ… é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
- âœ… é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- âœ… è‡ªå‹•å»ºç«‹ profile æ™‚é¡¯ç¤ºæ­¡è¿è¨Šæ¯
- âœ… å„ªé›…çš„éŒ¯èª¤è™•ç†

### è³‡æ–™å®Œæ•´æ€§
- âœ… ç¢ºä¿æ‰€æœ‰æŸ¥è©¢éƒ½æ˜ç¢ºæŒ‡å®šè¦æŸ¥è©¢çš„æ¬„ä½
- âœ… ç¢ºä¿æ‰€æœ‰å¿…è¦æ¬„ä½éƒ½è¢«åŒ…å«
- âœ… ä½¿ç”¨é è¨­å€¼é¿å… undefined éŒ¯èª¤

## ğŸ“‹ æ¸¬è©¦æ¸…å–®

### å°è¦½åˆ—æ¸¬è©¦
- [ ] æœªç™»å…¥æ™‚ï¼Œé»æ“Šäººåƒåœ–ç¤ºæ‡‰å°å‘ `/auth/login`
- [ ] å·²ç™»å…¥æ™‚ï¼Œé»æ“Šäººåƒåœ–ç¤ºæ‡‰å°å‘ `/profile`
- [ ] ç¢ºèªç„¡ Supabase å®¢æˆ¶ç«¯éŒ¯èª¤

### æœƒå“¡ä¸­å¿ƒæ¸¬è©¦
- [ ] è¨ªå• `/profile`ï¼ˆéœ€ç™»å…¥ï¼‰
- [ ] ç¢ºèªé é¢æ­£å¸¸è¼‰å…¥ï¼ˆç„¡ 404ã€ç„¡ 500ï¼‰
- [ ] æª¢æŸ¥æœƒå“¡è³‡æ–™é¡¯ç¤ºï¼ˆfull_name, member_levelï¼‰
- [ ] å¦‚æœ profile ä¸å­˜åœ¨ï¼Œç¢ºèªè‡ªå‹•å»ºç«‹
- [ ] æª¢æŸ¥è¨‚å–®åˆ—è¡¨é¡¯ç¤º
- [ ] æª¢æŸ¥è¨‚å–®ç·¨è™Ÿã€é‡‘é¡ã€ç‹€æ…‹é¡¯ç¤º

### éŒ¯èª¤è™•ç†æ¸¬è©¦
- [ ] æ¸¬è©¦åœ¨æœå‹™ç«¯ç’°å¢ƒä¸‹çš„è¡Œç‚ºï¼ˆæ‡‰å®‰å…¨è™•ç†ï¼‰
- [ ] æ¸¬è©¦ Supabase é€£æ¥å¤±æ•—çš„æƒ…æ³
- [ ] æ¸¬è©¦ profile ä¸å­˜åœ¨çš„æƒ…æ³ï¼ˆæ‡‰è‡ªå‹•å»ºç«‹ï¼‰

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **ç’°å¢ƒæª¢æŸ¥**ï¼šæ‰€æœ‰ Supabase å®¢æˆ¶ç«¯èª¿ç”¨éƒ½å¿…é ˆæª¢æŸ¥ `typeof window !== 'undefined'`
2. **éŒ¯èª¤è™•ç†**ï¼šæ·»åŠ å®Œæ•´çš„éŒ¯èª¤è™•ç†ï¼Œç¢ºä¿ç”¨æˆ¶é«”é©—
3. **è‡ªå‹•å»ºç«‹ Profile**ï¼šå¦‚æœ profile ä¸å­˜åœ¨ï¼Œè‡ªå‹•å»ºç«‹é è¨­ profile
4. **è³‡æ–™å®Œæ•´æ€§**ï¼šç¢ºä¿æ‰€æœ‰æŸ¥è©¢éƒ½æ˜ç¢ºæŒ‡å®šè¦æŸ¥è©¢çš„æ¬„ä½

## ğŸ¯ å¾ŒçºŒå„ªåŒ–å»ºè­°

1. **éŒ¯èª¤ç›£æ§**ï¼šå¯ä»¥è€ƒæ…®æ·»åŠ éŒ¯èª¤ç›£æ§æœå‹™
2. **è¼‰å…¥ç‹€æ…‹**ï¼šæ·»åŠ æ›´è©³ç´°çš„è¼‰å…¥é€²åº¦æŒ‡ç¤º
3. **å¿«å–æ©Ÿåˆ¶**ï¼šå°é »ç¹æŸ¥è©¢çš„è³‡æ–™åŠ å…¥å¿«å–
4. **æ¸¬è©¦è¦†è“‹**ï¼šæ·»åŠ å–®å…ƒæ¸¬è©¦å’Œé›†æˆæ¸¬è©¦
